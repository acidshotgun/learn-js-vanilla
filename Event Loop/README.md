<h2>EVENT LOOP</h2>

[ШПОРА С ТАБЛИЧКОЙ](https://habr.com/ru/articles/681882/)

# Event loop

- Поток выполнения в браузере, равно как и в Node.js, основан на событийном цикле.

<h2>Событийный цикл</h2>

- [ ] Идея `event loop` такая - Есть бесконечный цикл, в котором движок JavaScript (+ Node.js) ожидает задачи, исполняет их и снова ожидает появления новых.

  - Пока есть задачи:
    - выполнить их, начиная с самой старой
  - Бездействовать до появления новой задачи, а затем перейти к пункту 1

<br>

- [ ] Задачи поступают на выполнение – движок выполняет их – затем ожидает новые задачи (во время ожидания практически не нагружая процессор компьютера)

- [ ] Может так случиться, что задача поступает, когда движок занят чем-то другим, тогда она ставится в очередь.

- [ ] Очередь, которую формируют такие задачи, называют «очередью макрозадач» (macrotask queue, термин v8).

[ДИАГРАММА](https://app.diagrams.net/#G1875w0lyQMRABzLuQx39ppm7ouR_G_GxP)

<hr>
<br>
<br>

<h2>Макро и микротаски</h2>

- [ ] `Микротаски (Microtasks)`:

  - Микротаски представляют собой задачи, которые выполняются после завершения текущей операции и перед выполнением следующей макротаски.
  - Примеры микротасок включают обработчики промисов `(then, catch, finally)`.

- [ ] `Макротаски (Macrotasks)`:

  - Макротаски представляют собой задачи, которые выполняются после всех микротасок и перед началом следующего цикла событий.
  - Примеры макротасок включают `setTimeout`, `setInterval`, выполнение скриптов, обработку событий (например, кликов).

```javascript
// EVENT LOOP TASKS
console.log(1);

setTimeout(() => console.log(2));

Promise.resolve().then(() => console.log(3));

Promise.resolve().then(() => setTimeout(() => console.log(4)));

Promise.resolve().then(() => console.log(5));

setTimeout(() => console.log(6));

console.log(7);

// 1
// 7
// 3
// 5
// 2
// 6
// 4
//

setTimeout(function timeout() {
  console.log("Таймаут");
}, 0);

let p = new Promise(function (resolve, reject) {
  console.log("Создание промиса");
  resolve();
});

p.then(function () {
  console.log("Обработка промиса");
});

console.log("Конец скрипта");

// Создание промиса
// Конец скрипта
// Обработка промиса
// Таймаут
```
