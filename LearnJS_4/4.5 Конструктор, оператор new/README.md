# Конструктор, оператор "new"

- [ ] Обычный синтаксис `{...}` позволяет создать только один объект. Но зачастую нам нужно создать множество похожих, однотипных объектов, таких как пользователи, элементы меню и так далее.

  + Это можно сделать при помощи функции-конструктора и оператора `"new"`.

<hr>
<br>
<br>

<h2>Функция-конструктор</h2>

- [ ] Функции-конструкторы технически являются обычными функциями. Но есть два соглашения:

  + Имя функции-конструктора должно начинаться с большой буквы.
  + Функция-конструктор должна выполняться только с помощью оператора `"new"`.
     
```javascript
  function User(name, age) {
    this.name = name;
    this.isAdmin = false;
  
    this.sayHi = function () {
      console.log(`Привет, я ${this.name} мне ${this.age}`);
    };
  }
  
  const vova = new User("Vova", 15);
  const sasha = new User("Sasha", 18);
  
  console.log(vova); // - User { name: 'Vova', isAdmin: false, sayHi: [Function (anonymous)] }
  console.log(sasha); // - User { name: 'Vova', isAdmin: false, sayHi: [Function (anonymous)] }
```

<br>

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/4780949f-cf72-4018-90fe-dc5d8996631b)
![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/ea20e2be-9a04-488b-ae94-9aed957b6bcf)

<br>

  + Теперь, если нам будет необходимо создать других пользователей, мы можем просто вызвать `new User("Ann")`, `new User("Alice")` и так далее. Данная конструкция гораздо удобнее и читабельнее, чем многократное создание `литерала объекта`.

  + Это и является основной целью конструкторов – реализовать код для многократного создания однотипных объектов.

<br>

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/05ddd69a-6f78-45cb-9997-a5ba9c0481af)

<hr>
<br>
<br>

<h2>Проверка на вызов в режиме конструктора: new.target</h2>

- [ ] Используя специальное свойство `new.target` внутри функции, мы можем проверить, вызвана ли функция при помощи оператора `new` или без него.

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/30bdf6de-6798-4d6c-b17a-9f20059a7ef1)

<br>

  + Также мы можем сделать, чтобы вызовы с `new` и без него делали одно и то же:

```javascript
  function User(name, age) {
    if (!new.target) {
      // в случае, если вы вызвали меня без оператора new
      return new User(name, age); // ...я добавлю new за вас
    }
  
    this.name = name;
    this.age = age;
  
    console.log(new.target); // [Function: User]
  }
  
  // Теперь конструктор можно вызывать без new
  const sasha = User("Sasha", 15); // переадресовывает вызов на new User
  
  console.log(sasha); // User { name: 'Sasha', age: 15 }
```

  + Впрочем, вероятно, это не очень хорошая практика использовать этот трюк везде, так как отсутствие new может ввести разработчика в заблуждение. С `new` мы точно знаем, что создаётся новый объект.

<hr>
<br>
<br>

<h2>Возврат значения из конструктора, return</h2>

- [ ] Обычно `конструкторы` не имеют оператора `return`. Их задача – записать все необходимое в `this`, и это автоматически становится результатом.

- [x] Но если `return` всё же есть, то применяется простое правило:

    + При вызове `return` с объектом, вместо `this` `вернётся объект`.
    + При вызове `return` с `примитивным значением`, оно `проигнорируется`.
     
    <br>

    + Другими словами, `return` с объектом возвращает этот объект, во всех остальных случаях возвращается `this`.

    ![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/393dc395-0ae2-4079-ade5-818770940f7d)
    ![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/68e703f7-4581-42f0-a5c9-df7852ef8e2b)

<br>

+ Обычно у конструкторов отсутствует `return`. Здесь мы упомянули особое поведение с возвращаемыми объектами в основном для полноты картины.

<hr>
<br>
<br>

<h2>Создание методов в конструкторе</h2>

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/3f660600-a8e4-4d54-acc7-3b6b215983a9)

<hr>
<br>
<br>

<h2>ИТОГО</h2>

  + `Функции-конструкторы` или просто конструкторы, являются обычными функциями, но существует общепринятое соглашение именовать их с заглавной буквы.
  + `Функции-конструкторы` следует вызывать только с помощью `new`. Такой вызов подразумевает создание пустого `this` в начале и возврат заполненного в конце.
  + Мы можем использовать конструкторы для создания множества похожих объектов.
