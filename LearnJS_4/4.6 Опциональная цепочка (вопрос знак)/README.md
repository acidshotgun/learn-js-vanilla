# Опциональная цепочка '?.'

- [ ] `Опциональная цепочка ?`. — это безопасный способ доступа к свойствам вложенных объектов, даже если какое-либо из промежуточных свойств не существует.

<hr>
<br>
<br>

<h2>Проблема «несуществующего свойства»</h2>

- [ ] Проблема возникает тогда, когда мы хотя получить у объекта св-во, которое находится в несуществующем св-ве и получаем ошибку, хотя на самом деле ожидаем получить `undefined`

  + Например у большинства наших пользователей есть адреса в свойстве `user.address` с улицей `user.address.street`, но некоторые из них их не указали.

  + В таком случае, когда мы попытаемся получить user.address.street, а пользователь окажется без адреса, мы получим ошибку:

```javascript
  let user = {}; // пользователь без свойства "address"

  console.log(user.address.street); // Ошибка!

/*
  В таком случае, когда мы попытаемся получить user.address.street, а пользователь окажется без адреса, мы получим ошибку.
  Посколько adress = undefined, мы пытаемся получить св-во в несуществующем св-ве

  Однако ожидаем получить undefined
*/ 
```

  + Это ожидаемый результат. JavaScript работает следующим образом. Поскольку `user.address` имеет значение `undefined`, попытка получить `user.address.street` завершается `ошибкой`.

  <br>
  <br>

  + Очевидным решением было бы проверить значение с помощью `if` или условного оператора `?`, прежде чем обращаться к его свойству, вот так:

  ```javascript
    let user = {};

    console.log(user.address ? user.address.street : undefined);

  // Работает но не элегантно
  // А при увеличении св-в - цепочка будет расти

  // Проверим еще и name
  let user = {}; // у пользователя нет адреса

    console.log(user.address ? user.address.street ? user.address.street.name : null : null);
  ```

  <br>

  + Есть немного лучший способ написать это, используя оператор `&&`:

  ```javascript
    let user = {}; // пользователь без адреса

    console.log( user.address && user.address.street && user.address.street.name ); // undefined (без ошибки)
  ```

  + Проход при помощи логического оператора `И &&` через весь путь к свойству гарантирует, что все компоненты существуют (если нет, вычисление прекращается), но также не является идеальным. `Имена свойств по-прежнему дублируются в коде`. Например, в приведённом выше коде `user.address` появляется три раза.

  + Вот почему в язык была добавлена опциональная цепочка `?`.. Чтобы решить эту проблему – раз и навсегда!

<hr>
<br>
<br>

<h2>Опциональная цепочка</h2>

- [x] Опциональная цепочка `?.` `останавливает вычисление и возвращает undefined`, если значение перед `?.` равно `undefined` или `null`.

  + Другими словами, `value?.prop`:
  
    + работает как `value.prop`, если значение `value` существует,
    + в противном случае (когда `value равно undefined/null`) он возвращает `undefined`.
   
    ```javascript
      let user = {}; // пользователь без адреса

    // Код лаконичный и понятный, в нем вообще нет дублирования.
      console.log( user?.address?.street ); // undefined (без ошибки)
    ```

    <br>

    + Считывание адреса с помощью `user?.address` работает, даже если объект user не существует совсем:
   
    ```javascript
      let user = null;

      console.log( user?.address ); // undefined
      console.log( user?.address.street ); // undefined
    ```

<br>

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/99cde901-11f3-4ae9-b88b-320f73c05638)

<br>

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/50aec3e5-9ffa-4c60-9d78-8043ae4d24f7)

<br>

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/539b4742-163f-4260-9fb9-235e5bb98702)

<hr>
<br>
<br>

<h2>Сокращённое вычисление</h2>

  + Как было сказано ранее, `?`. немедленно останавливает вычисление, если левая часть не существует.
  
  + Так что если после `?`. есть какие-то вызовы функций или операции, то они не произойдут.

```javascript
  let user = null;
  let x = 0;
  
  user?.sayHi(x++); // нет "user", поэтому выполнение не достигает вызова sayHi и x++
  
  console.log(x); // 0, значение не увеличилось
```

<hr>
<br>
<br>

<h2>Другие варианты применения: ?.(), ?.[]</h2>

- [ ] `Опциональная цепочка ?.` — это не оператор, а специальная синтаксическая конструкция, которая также работает с функциями и квадратными скобками.

+ Например, `?.()` используется для вызова функции, которая может не существовать.
     
  ```javascript
    // В приведённом ниже коде у некоторых наших пользователей есть метод admin, а у некоторых его нет:
  
    let userAdmin = {
      admin() {
        alert("Я админ");
      }
    };
    
    let userGuest = {};
    
    userAdmin.admin?.(); // Я админ
    
    userGuest.admin?.(); // ничего не произойдет (такого метода нет)
  ```

    + Здесь в обеих строках мы сначала используем точку (userAdmin.admin), чтобы получить свойство admin, потому что мы предполагаем, что объект userAdmin существует, так что читать из него безопасно.

    + Затем `?.()` проверяет левую часть: если функция admin существует, то она запускается (это так для userAdmin). В противном случае (для userGuest) вычисление остановится без ошибок.
     
<br>
<br>

  + Синтаксис `?.[]` также работает, если мы хотим использовать скобки `[]` для доступа к свойствам вместо точки `.`. Как и в предыдущих случаях, он позволяет безопасно считывать свойство из объекта, который может не существовать.

  ```javascript
    let key = "firstName";

    let user1 = {
      firstName: "John"
    };
    
    let user2 = null;
    
    alert( user1?.[key] ); // John
    alert( user2?.[key] ); // undefined
  ```

<br>
<br>

  + Также мы можем использовать `?.` с `delete`:

  ```javascript
    delete user?.name; // удаляет user.name если пользователь существует
  ```

<br>
<br>

![image](https://github.com/acidshotgun/learn-js-vanilla/assets/117285472/57f9711b-ad0e-4114-8422-806cdf1b799c)

<hr>
<br>
<br>

<h2>ИТОГО</h2>

- [x] Синтаксис опциональной цепочки `?.` имеет три формы:

  + `obj?.prop` – возвращает obj.prop если obj существует, в противном случае `undefined`.
  + `obj?.[prop]` – возвращает obj[prop] если obj существует, в противном случае `undefined`.
  + `obj.method?.()` – вызывает obj.method(), если obj.method существует, в противном случае возвращает `undefined`.
     
+ `?.` проверяет левую часть на `null/undefined` и позволяет продолжить вычисление, если это не так.

- [x] Цепочка `?.` позволяет безопасно получать доступ к вложенным свойствам.

- [x] Тем не менее, мы должны использовать `?.` осторожно, только там, где по логике кода допустимо, что левая часть не существует. Чтобы он не скрывал от нас ошибки программирования, если они возникнут.
